<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Student List | Super Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800">
    <!-- Mobile Nav Header -->
    <%- include("../partials/adminHeader.ejs") %>

        <div class="flex h-screen overflow-hidden pt-16 md:pt-0">
            <!-- Sidebar -->
            <%- include("../partials/adminSidebar.ejs") %>

                <!-- Main Content -->
                <main class="flex-1 overflow-y-auto bg-slate-50 p-6 md:p-10">
                    <div class="max-w-7xl mx-auto">
                        <header class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div>
                                <h1 class="text-4xl font-bold text-slate-900 tracking-tight mb-2">Master Student List
                                </h1>
                                <p class="text-slate-500 font-medium italic">Global record of every student across all
                                    schools.
                                </p>
                            </div>
                        </header>

                        <!-- Search & Search Filters -->
                        <form method="GET" action="/superAdmin/students"
                            class="bg-white p-6 rounded-3xl shadow-sm border border-rose-50 mb-8 flex flex-col md:flex-row gap-4">
                            <div class="flex-1 relative">
                                <input id="searchInput" type="text" name="search"
                                    placeholder="Search by student name..." value="<%= searchText %>"
                                    class="w-full pl-12 pr-4 py-3 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-rose-200 outline-none transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="h-5 w-5 text-slate-400 absolute left-4 top-3.5" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                            <select name="schoolId"
                                class="md:w-48 bg-slate-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-rose-200 outline-none"
                                onchange="this.form.submit()">
                                <option value="">All Schools</option>
                                <% schools.forEach(s=> { %>
                                    <option value="<%= s._id %>" <%=selectedSchool==s._id ? "selected" : "" %>>
                                        <%= s.name %>
                                    </option>
                                    <% }) %>
                            </select>

                        </form>

                        <div class="bg-white rounded-[2rem] shadow-sm border border-rose-50 overflow-hidden">
                            <table class="w-full text-left">
                                <thead
                                    class="bg-slate-50 text-slate-500 text-[0.65rem] font-black uppercase tracking-[0.15em]">
                                    <tr>
                                        <th class="px-8 py-6">Student Info</th>
                                        <th class="px-8 py-6">School</th>
                                        <th class="px-8 py-6">Class/Grade</th>
                                        <th class="px-8 py-6">Status</th>
                                        <!-- <th class="px-8 py-6 text-right">Actions</th> -->
                                    </tr>
                                </thead>
                                <tbody id="masterStudentTable">
                                    <% if (students.length===0) { %>
                                        <tr>
                                            <td colspan="5" class="text-center py-10 text-gray-400">
                                                No students found
                                            </td>
                                        </tr>
                                        <% } %>

                                            <% students.forEach(stu=> { %>
                                                <tr class="border-t">
                                                    <td class="px-8 py-4">
                                                        <div class="flex items-center">
                                                            <% if (stu.image) { %>
                                                                <!-- Student Image -->
                                                                <img src="<%= stu.image %>" alt="<%= stu.name %>"
                                                                    class="h-10 w-10 rounded-full object-cover mr-4 border" />
                                                                <% } else { %>
                                                                    <div
                                                                        class="h-10 w-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-sm mr-4">
                                                                        <%= stu.name.charAt(0).toUpperCase() %>
                                                                    </div>
                                                                    <% } %>
                                                                        <p>
                                                                            <%= stu.name %>
                                                                        </p>
                                                        </div>
                                                    </td>
                                                    <td class="px-8 py-4">
                                                        <p class="font-semibold">
                                                            <%= stu.schoolId?.name %>
                                                        </p>
                                                    </td>
                                                    <td class="px-8 py-4">
                                                        <%= stu.classId?.className || "-" %>
                                                    </td>
                                                    <td class="px-8 py-4">
                                                        <%= stu.status %>
                                                    </td>
                                                </tr>
                                                <% }) %>
                                </tbody>
                        </div>
                    </div>
                </main>
        </div>

        <%- include("../partials/adminHeaderLogic.ejs") %>

            <script>
                const searchInput = document.getElementById("searchInput");
                const tableBody = document.getElementById("masterStudentTable");

                let debounceTimer;

                async function fetchStudents(query = "") {
                    const res = await fetch(`/superAdmin/students?ajax=true&search=${query}`);
                    const students = await res.json();

                    tableBody.innerHTML = "";

                    if (students.length === 0) {
                        tableBody.innerHTML = `
        <tr>
          <td colspan="5" class="text-center py-10 text-gray-400">
            No students found
          </td>
        </tr>`;
                        return;
                    }

                    students.forEach(stu => {
                        const imageHtml = stu.image
                            ? `<img src="${stu.image}" class="h-10 w-10 rounded-full object-cover mr-4 border" />`
                            : `<div class="h-10 w-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-sm mr-4">
             ${stu.name.charAt(0).toUpperCase()}
           </div>`;

                        tableBody.innerHTML += `
        <tr class="border-t">
          <td class="px-8 py-4">
            <div class="flex items-center">
              ${imageHtml}
              <p>${stu.name}</p>
            </div>
          </td>
          <td class="px-8 py-4 font-semibold">
            ${stu.schoolId?.name || "-"}
          </td>
          <td class="px-8 py-4">
            ${stu.classId?.className || "-"}
          </td>
          <td class="px-8 py-4">
            ${stu.status}
          </td>
        </tr>`;
                    });
                }

                searchInput.addEventListener("input", e => {
                    clearTimeout(debounceTimer);

                    debounceTimer = setTimeout(() => {
                        fetchStudents(e.target.value.trim());
                    }, 300);
                });
            </script>



</body>

</html>